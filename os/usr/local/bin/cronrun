#!/usr/bin/env bash

set -ex
name=$(echo $2 | awk '{print $1}' | sed 's/^.*\.\///' | rev | cut -d'.' -f2- | rev | tr '/' '.')
log=/var/log/crontab/$(basename $1).$name
bash -c "source /etc/profile && cd $1 && exec timeout 24h direnv exec . ${@:2}" > $log.log 2>$log.err.log
